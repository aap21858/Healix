openapi: 3.0.3
info:
  title: Healix Clinic Management API
  description: |
    REST API for clinic management system with EHR support for Maharashtra small to mid-sized clinics.
    
    ## Features
    - Patient registration and management
    - Emergency contact management
    - Insurance details tracking
    - Medical history records

  version: 1.0.0
  contact:
    name: Healix Support
    email: support@healix.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080
    description: Development Server
  - url: https://api.healix.com
    description: Production Server

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Patient Management
    description: Patient registration and CRUD operations
  - name: Insurance Schemes
    description: Insurance scheme reference data
  - name: Staff Management
    description: Staff/Admin user management
  - name: Dropdown Lookup
    description: Generic dropdown/lookup reference data management
  - name: Appointment Management
    description: Appointment scheduling, triage, consultation, prescriptions, and IPD management

# ============================================
# PATHS (API Endpoints)
# ============================================

paths:
  # ==================== Authentication ====================

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and receive JWT token
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/validate:
    get:
      tags:
        - Authentication
      summary: Validate JWT token
      description: Validate if the provided JWT token is valid
      operationId: validateToken
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Valid token"
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/set-password:
    post:
      tags:
        - Authentication
      summary: Set/Reset password
      description: Set password for new user or reset forgotten password
      operationId: setPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetPasswordRequest'
      responses:
        '200':
          description: Password set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password set successfully"
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ==================== Patient Management ====================

  /api/patients:
    post:
      tags:
        - Patient Management
      summary: Register multiple patients (batch registration)
      description: Register one or more patients with personal, emergency, insurance, and medical details
      operationId: registerPatient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/PatientRegistrationRequest'
              minItems: 1
              maxItems: 1000  # Optional: limit batch size
      responses:
        '201':
          description: Patients registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchPatientResponse'  # âœ… New response schema
        '207':
          description: Multi-status - Some patients registered, some failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchPatientResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      tags:
        - Patient Management
      summary: Get all patients (paginated)
      description: Retrieve paginated list of all patients
      operationId: getAllPatients
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
        - $ref: '#/components/parameters/SortParam'
      responses:
        '200':
          description: Patients retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientPageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/patients/{id}:
    get:
      tags:
        - Patient Management
      summary: Get patient by ID
      description: Retrieve patient details by database ID
      operationId: getPatientById
      parameters:
        - name: id
          in: path
          required: true
          description: Patient database ID
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        '200':
          description: Patient found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    put:
      tags:
        - Patient Management
      summary: Update patient
      description: Update existing patient details
      operationId: updatePatient
      parameters:
        - name: id
          in: path
          required: true
          description: Patient database ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientRegistrationRequest'
      responses:
        '200':
          description: Patient updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      tags:
        - Patient Management
      summary: Delete (deactivate) patient
      description: Soft delete patient by setting status to INACTIVE
      operationId: deletePatient
      parameters:
        - name: id
          in: path
          required: true
          description: Patient database ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Patient deactivated successfully
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/patients/{id}/activate:
    patch:
      tags:
        - Patient Management
      summary: Activate patient by ID
      description: Set patient status to ACTIVE
      operationId: activatePatient
      parameters:
        - name: id
          in: path
          required: true
          description: Patient database ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Patient activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/patients/patient-id/{patientId}:
    get:
      tags:
        - Patient Management
      summary: Get patient by Patient ID
      description: Retrieve patient details by Patient ID (e.g., SNG2025001)
      operationId: getPatientByPatientId
      parameters:
        - name: patientId
          in: path
          required: true
          description: Patient ID (e.g., SNG2025001)
          schema:
            type: string
            example: "SNG2025001"
      responses:
        '200':
          description: Patient found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientResponse'
        '404':
          description: Patient not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/patients/search:
    get:
      tags:
        - Patient Management
      summary: Search patients
      description: Search patients by name, patient ID, or mobile number
      operationId: searchPatients
      parameters:
        - name: query
          in: query
          required: true
          description: Search query (name, patient ID, or mobile)
          schema:
            type: string
            example: "Rahul"
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientPageResponse'

  # ==================== Insurance Schemes ====================

  /api/insurance-schemes:
    get:
      tags:
        - Insurance Schemes
      summary: Get all active insurance schemes
      description: Retrieve all active insurance schemes ordered by display order
      operationId: getAllActiveSchemes
      security: []
      responses:
        '200':
          description: Insurance schemes retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InsuranceScheme'

  /api/insurance-schemes/type/{schemeType}:
    get:
      tags:
        - Insurance Schemes
      summary: Get schemes by type
      description: Get GOVERNMENT or PRIVATE insurance schemes
      operationId: getSchemesByType
      security: []
      parameters:
        - name: schemeType
          in: path
          required: true
          description: Scheme type (GOVERNMENT or PRIVATE)
          schema:
            type: string
            enum:
              - GOVERNMENT
              - PRIVATE
            example: "GOVERNMENT"
      responses:
        '200':
          description: Schemes retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InsuranceScheme'

  # ==================== Staff Management ====================

  /api/staff:
    get:
      tags:
        - Staff Management
      summary: Get all staff members
      description: Retrieve all staff members (Admin only)
      operationId: getAllStaff
      responses:
        '200':
          description: Staff list retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StaffResponse'

  /api/staff/{id}:
    get:
      tags:
        - Staff Management
      summary: Get staff by ID
      description: Retrieve staff member details by ID
      operationId: getStaffById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Staff member found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StaffResponse'
        '404':
          description: Staff not found

    put:
      tags:
        - Staff Management
      summary: Update staff member
      description: Update staff member details (Admin only)
      operationId: updateStaff
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StaffUpdateRequest'
      responses:
        '200':
          description: Staff updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Record Updated for John Doe successfully"

    delete:
      tags:
        - Staff Management
      summary: Delete staff member
      description: Delete staff member (Admin only)
      operationId: deleteStaff
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Staff deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Record Deleted Successfully"

  /api/admin/register:
    post:
      tags:
        - Staff Management
      summary: Register new staff member
      description: Register new staff/admin user (Admin only)
      operationId: registerStaff
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StaffRegistrationRequest'
      responses:
        '200':
          description: Staff registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Activation email sent to user@example.com"

    # ==================== Patient Management ====================

  /api/patients/upload-csv:
      post:
        tags:
          - Patient Management
        summary: Upload CSV file for bulk patient registration
        description: |
          Upload a CSV file containing patient details for batch registration.

          **CSV Format:**
          - First row must be headers (case-insensitive)
          - Required columns: firstName, lastName, dateOfBirth, gender, mobileNumber, city, pinCode
          - Optional columns: bloodGroup, aadharNumber, emailId, addressLine1, district, state

          **Example CSV:**
          ```
          firstName,lastName,dateOfBirth,gender,bloodGroup,mobileNumber,emailId,city,pinCode
          Rahul,Patil,1985-03-15,MALE,O+,9876543210,rahul@gmail.com,Sangli,416416
          Priya,Sharma,1990-07-22,FEMALE,A+,9876543211,priya@gmail.com,Sangli,416416
          ```
        operationId: uploadPatientsCsv
        requestBody:
          required: true
          content:
            multipart/form-data:
              schema:
                type: object
                required:
                  - file
                properties:
                  file:
                    type: string
                    format: binary
                    description: CSV file containing patient data
        responses:
          '200':
            description: CSV processed successfully (may contain partial failures)
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/CsvUploadResponse'
          '400':
            description: Invalid CSV file or format
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResponse'
          '401':
            $ref: '#/components/responses/UnauthorizedError'

  /api/patients/download-csv-template:
    get:
      tags:
        - Patient Management
      summary: Download CSV template
      description: Download a CSV template file with proper headers for patient import
      operationId: downloadCsvTemplate
      responses:
        '200':
          description: CSV template file
          content:
            text/csv:
              schema:
                type: string
                format: binary

  # ==================== Dropdown Lookup ====================
  /api/dropdowns:
    post:
      tags:
        - Dropdown Lookup
      summary: Create multiple dropdown lookup entries
      description: Insert multiple lookup records (bulk). Each record must contain type and code.
      operationId: createDropdowns
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DropdownLookupRequest'
              minItems: 1
              maxItems: 500
      responses:
        '201':
          description: Created successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DropdownLookupResponse'
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - Dropdown Lookup
      summary: Get all dropdown entries
      description: Retrieve all dropdown lookup entries
      operationId: getAllDropdowns
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DropdownLookupResponse'

  /api/dropdowns/type/{type}:
    get:
      tags:
        - Dropdown Lookup
      summary: Get dropdown values by type
      description: Retrieve dropdown lookup entries for a given type. Use query param 'active' to filter only active values.
      operationId: getDropdownsByType
      parameters:
        - name: type
          in: path
          required: true
          description: Lookup type (e.g., INSURANCE_SCHEME, GENDER)
          schema:
            type: string
            example: "INSURANCE_SCHEME"
        - name: active
          in: query
          required: false
          description: When true, only active entries are returned. When false, only inactive entries. If omitted, returns all.
          schema:
            type: boolean
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DropdownLookupResponse'
        '404':
          description: No entries found for the given type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/dropdowns/{id}:
    get:
      tags:
        - Dropdown Lookup
      summary: Get dropdown by ID
      description: Retrieve a specific dropdown lookup entry by its ID
      operationId: getDropdownById
      parameters:
        - name: id
          in: path
          required: true
          description: Dropdown lookup ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DropdownLookupResponse'
        '404':
          description: Entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Dropdown Lookup
      summary: Update dropdown lookup entry
      description: Update an existing dropdown lookup entry
      operationId: updateDropdown
      parameters:
        - name: id
          in: path
          required: true
          description: Dropdown lookup ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DropdownLookupRequest'
      responses:
        '200':
          description: Updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DropdownLookupResponse'
        '404':
          description: Entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    patch:
      tags:
        - Dropdown Lookup
      summary: Partially update dropdown lookup entry
      description: Update specific fields of an existing dropdown lookup entry
      operationId: patchDropdown
      parameters:
        - name: id
          in: path
          required: true
          description: Dropdown lookup ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DropdownLookupResponse'
        '404':
          description: Entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      tags:
        - Dropdown Lookup
      summary: Delete dropdown lookup entry
      description: Permanently delete a dropdown lookup entry
      operationId: deleteDropdownById
      parameters:
        - name: id
          in: path
          required: true
          description: Dropdown lookup ID
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Deleted successfully
        '404':
          description: Entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # ==================== Appointment Management ====================
  /api/appointments:
    post:
      tags:
        - Appointment Management
      summary: Create new appointment
      description: Schedule a new OPD or IPD appointment
      operationId: createAppointment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointmentRequest'
      responses:
        '201':
          description: Appointment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    get:
      tags:
        - Appointment Management
      summary: Get all appointments
      description: Retrieve all appointments with pagination
      operationId: getAllAppointments
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
        - $ref: '#/components/parameters/SortParam'
      responses:
        '200':
          description: Appointments retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentPageResponse'

  /api/appointments/{id}:
    get:
      tags:
        - Appointment Management
      summary: Get appointment by ID
      description: Retrieve detailed appointment information
      operationId: getAppointmentById
      parameters:
        - name: id
          in: path
          required: true
          description: Appointment ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Appointment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentDetailResponse'
        '404':
          description: Appointment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - Appointment Management
      summary: Update appointment
      description: Update existing appointment details
      operationId: updateAppointment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointmentRequest'
      responses:
        '200':
          description: Appointment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '404':
          description: Appointment not found

    delete:
      tags:
        - Appointment Management
      summary: Cancel appointment
      description: Cancel an appointment
      operationId: cancelAppointment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Appointment cancelled successfully
        '404':
          description: Appointment not found

  /api/appointments/search:
    get:
      tags:
        - Appointment Management
      summary: Search appointments
      description: Search appointments by patient name, ID, contact, date, physician, or status
      operationId: searchAppointments
      parameters:
        - name: patientName
          in: query
          description: Patient name (partial match)
          schema:
            type: string
        - name: patientId
          in: query
          description: Patient ID
          schema:
            type: integer
            format: int64
        - name: contactNumber
          in: query
          description: Patient contact number
          schema:
            type: string
        - name: appointmentDate
          in: query
          description: Appointment date (YYYY-MM-DD)
          schema:
            type: string
            format: date
        - name: physicianId
          in: query
          description: Physician ID
          schema:
            type: integer
            format: int64
        - name: status
          in: query
          description: Appointment status
          schema:
            $ref: '#/components/schemas/AppointmentStatus'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentPageResponse'

  /api/appointments/{id}/status:
    patch:
      tags:
        - Appointment Management
      summary: Update appointment status
      description: Change appointment status (e.g., WAITING, IN_CONSULTATION, etc.)
      operationId: updateAppointmentStatus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  $ref: '#/components/schemas/AppointmentStatus'
      responses:
        '200':
          description: Status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '404':
          description: Appointment not found

  # ==================== Triage Management ====================
  /api/appointments/{appointmentId}/triage:
    post:
      tags:
        - Appointment Management
      summary: Create or update triage data
      description: Record pre-consultation assessment by nurse or junior doctor
      operationId: createOrUpdateTriage
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriageRequest'
      responses:
        '201':
          description: Triage data recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriageResponse'
        '404':
          description: Appointment not found

    get:
      tags:
        - Appointment Management
      summary: Get triage data
      description: Retrieve triage data for an appointment
      operationId: getTriageByAppointment
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Triage data retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriageResponse'
        '404':
          description: Triage data not found

  # ==================== Vitals Management ====================
  /api/appointments/{appointmentId}/vitals:
    post:
      tags:
        - Appointment Management
      summary: Record vitals
      description: Record patient vitals during triage
      operationId: recordVitals
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VitalsRequest'
      responses:
        '201':
          description: Vitals recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VitalsResponse'
        '404':
          description: Appointment not found

    get:
      tags:
        - Appointment Management
      summary: Get vitals
      description: Retrieve all vitals records for an appointment
      operationId: getVitalsByAppointment
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Vitals retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VitalsResponse'

  # ==================== Examination Management ====================
  /api/appointments/{appointmentId}/examination:
    post:
      tags:
        - Appointment Management
      summary: Record examination
      description: Record doctor's examination findings and diagnosis
      operationId: recordExamination
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExaminationRequest'
      responses:
        '201':
          description: Examination recorded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExaminationResponse'
        '404':
          description: Appointment not found

    get:
      tags:
        - Appointment Management
      summary: Get examination
      description: Retrieve examination data for an appointment
      operationId: getExaminationByAppointment
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Examination retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExaminationResponse'
        '404':
          description: Examination not found

  # ==================== Prescription Management ====================
  /api/appointments/{appointmentId}/prescriptions:
    post:
      tags:
        - Appointment Management
      summary: Create prescription
      description: Create prescription with medication items
      operationId: createPrescription
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrescriptionRequest'
      responses:
        '201':
          description: Prescription created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrescriptionResponse'
        '404':
          description: Appointment not found

    get:
      tags:
        - Appointment Management
      summary: Get prescriptions
      description: Retrieve all prescriptions for an appointment
      operationId: getPrescriptionsByAppointment
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Prescriptions retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PrescriptionResponse'

  /api/prescriptions/{id}:
    get:
      tags:
        - Appointment Management
      summary: Get prescription by ID
      description: Retrieve prescription details
      operationId: getPrescriptionById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Prescription found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrescriptionResponse'
        '404':
          description: Prescription not found

  /api/prescriptions/{id}/status:
    patch:
      tags:
        - Appointment Management
      summary: Update prescription status
      description: Change prescription status (DRAFT, PRESCRIBED, DISPENSED)
      operationId: updatePrescriptionStatus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  $ref: '#/components/schemas/PrescriptionStatus'
      responses:
        '200':
          description: Status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrescriptionResponse'

  # ==================== Investigation Orders ====================
  /api/appointments/{appointmentId}/investigations:
    post:
      tags:
        - Appointment Management
      summary: Create investigation order
      description: Order pathology or radiology investigation
      operationId: createInvestigationOrder
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvestigationOrderRequest'
      responses:
        '201':
          description: Investigation ordered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestigationOrderResponse'
        '404':
          description: Appointment not found

    get:
      tags:
        - Appointment Management
      summary: Get investigation orders
      description: Retrieve all investigation orders for an appointment
      operationId: getInvestigationsByAppointment
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Investigations retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InvestigationOrderResponse'

  /api/investigations/{id}/result:
    patch:
      tags:
        - Appointment Management
      summary: Update investigation result
      description: Record investigation result and report
      operationId: updateInvestigationResult
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvestigationResultRequest'
      responses:
        '200':
          description: Result updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestigationOrderResponse'

  # ==================== Referral Management ====================
  /api/appointments/{appointmentId}/refer:
    post:
      tags:
        - Appointment Management
      summary: Create referral
      description: Refer patient to another department or physician
      operationId: createReferral
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReferralRequest'
      responses:
        '201':
          description: Referral created and new appointment scheduled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '404':
          description: Appointment not found

  # ==================== IPD Management ====================
  /api/appointments/{appointmentId}/admit:
    post:
      tags:
        - Appointment Management
      summary: Admit patient (Convert OPD to IPD)
      description: Admit patient for inpatient care, allocate bed
      operationId: admitPatient
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdmitRequest'
      responses:
        '200':
          description: Patient admitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '404':
          description: Appointment not found
        '400':
          description: Invalid admission request (e.g., already admitted, bed unavailable)

  /api/appointments/{appointmentId}/discharge:
    post:
      tags:
        - Appointment Management
      summary: Discharge patient
      description: Discharge patient from IPD
      operationId: dischargePatient
      parameters:
        - name: appointmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DischargeRequest'
      responses:
        '200':
          description: Patient discharged successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'
        '404':
          description: Appointment not found

# ============================================
# COMPONENTS (Schemas, Parameters, etc.)
# ============================================

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  parameters:
    PageParam:
      name: page
      in: query
      description: Page number (0-indexed)
      schema:
        type: integer
        minimum: 0
        default: 0
        example: 0

    SizeParam:
      name: size
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20

    SortParam:
      name: sort
      in: query
      description: "sort param"
      schema:
        type: string
        default: "createdAt,desc"
        example: "createdAt,desc"

  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    # ==================== Enums ====================

    Gender:
      type: string
      enum:
        - MALE
        - FEMALE
        - OTHER
      example: MALE

    BloodGroup:
      type: string
      enum:
        - "A+"
        - "A-"
        - "B+"
        - "B-"
        - "O+"
        - "O-"
        - "AB+"
        - "AB-"
      example: "O+"

    Relationship:
      type: string
      enum:
        - SELF
        - SPOUSE
        - PARENT
        - CHILD
        - SIBLING
        - FRIEND
        - OTHER
      example: SPOUSE

    InsuranceType:
      type: string
      enum:
        - GOVERNMENT
        - PRIVATE
        - NONE
      example: GOVERNMENT

    PreferredContactMethod:
      type: string
      enum:
        - SMS
        - WHATSAPP
        - EMAIL
        - PHONE_CALL
      example: WHATSAPP

    PatientStatus:
      type: string
      enum:
        - ACTIVE
        - INACTIVE
      example: ACTIVE

    StaffStatus:
      type: string
      enum:
        - ACTIVE
        - INACTIVE
      example: ACTIVE

    StaffRole:
      type: string
      enum:
        - ADMIN
        - DOCTOR
        - RECEPTIONIST
        - NURSE
      example: DOCTOR

    # ==================== Authentication Models ====================

    LoginRequest:
      type: object
      required:
        - emailId
        - password
      properties:
        emailId:
          type: string
          format: email
          example: "aap@gmail.com"
        password:
          type: string
          format: password
          example: "admin123"

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        role:
          type: array
          items:
            type: string
          example: ["ROLE_ADMIN", "ROLE_DOCTOR"]

    SetPasswordRequest:
      type: object
      required:
        - token
        - password
      properties:
        token:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        password:
          type: string
          format: password
          minLength: 8
          example: "NewSecurePass123!"

    # ==================== Patient Models ====================

    PatientRegistrationRequest:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      required:
        - firstName
        - lastName
        - dateOfBirth
        - gender
        - mobileNumber
        - city
        - pinCode
      properties:
        firstName:
          type: string
          maxLength: 100
          example: "Rahul"
        lastName:
          type: string
          maxLength: 100
          example: "Patil"
        dateOfBirth:
          type: string
          format: date
          example: "1985-03-15"
        gender:
          $ref: '#/components/schemas/Gender'
        bloodGroup:
          $ref: '#/components/schemas/BloodGroup'
        aadharNumber:
          type: string
          pattern: '^[0-9]{12}$'
          example: "123456789012"
        photoUrl:
          type: string
          format: string
          maxLength: 500
          example: "https://example.com/photos/rahul.jpg"
        mobileNumber:
          type: string
          pattern: '^[0-9]{10}$'
          example: "9876543210"
        emailId:
          type: string
          format: email
          example: "rahul.patil@gmail.com"
        preferredContactMethod:
          $ref: '#/components/schemas/PreferredContactMethod'
        addressLine1:
          type: string
          maxLength: 510
          example: "123 Main Street, Vishrambag"
        city:
          type: string
          maxLength: 100
          example: "Sangli"
        district:
          type: string
          maxLength: 100
          example: "Sangli"
        state:
          type: string
          maxLength: 50
          default: "Maharashtra"
          example: "Maharashtra"
        pinCode:
          type: string
          pattern: '^[0-9]{6}$'
          example: "416416"
        emergencyContacts:
          type: array
          items:
            $ref: '#/components/schemas/EmergencyContactRequest'
        insurance:
          $ref: '#/components/schemas/InsuranceRequest'
        medicalHistory:
          $ref: '#/components/schemas/MedicalHistoryRequest'

    EmergencyContactRequest:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      required:
        - contactPersonName
        - relationship
        - contactNumber
      properties:
        contactPersonName:
          type: string
          maxLength: 100
          example: "Sunita Patil"
        relationship:
          $ref: '#/components/schemas/Relationship'
        contactNumber:
          type: string
          pattern: '^[0-9]{10}$'
          example: "9876543220"
        isPrimary:
          type: boolean
          default: true
          example: true

    InsuranceRequest:
      type: object
      required:
        - hasInsurance
      properties:
        hasInsurance:
          type: boolean
          example: true
        insuranceType:
          $ref: '#/components/schemas/InsuranceType'
        schemeId:
          type: integer
          format: int64
          example: 1
        policyCardNumber:
          type: string
          maxLength: 50
          example: "MJPJAY123456"
        policyHolderName:
          type: string
          maxLength: 100
          example: "Rahul Patil"
        relationshipToHolder:
          $ref: '#/components/schemas/Relationship'
        policyExpiryDate:
          type: string
          format: date
          example: "2025-12-31"
        insuranceCardFrontUrl:
          type: string
          format: string
          maxLength: 500
        insuranceCardBackUrl:
          type: string
          format: string
          maxLength: 500
        pmjayCardUrl:
          type: string
          format: string
          maxLength: 500
        claimAmountLimit:
          type: number
          format: decimal
          minimum: 0
          example: 500000.00

    MedicalHistoryRequest:
      type: object
      properties:
        knownAllergies:
          type: array
          items:
            type: string
          example: ["Penicillin", "Peanuts"]
        currentMedications:
          type: array
          items:
            type: string
          example: ["Metformin 500mg twice daily", "Aspirin 75mg"]
        pastSurgeries:
          type: string
          example: "Appendectomy (2010)"
        chronicConditions:
          type: string
          example: "Type 2 Diabetes, Hypertension"
        familyMedicalHistory:
          type: string
          example: "Father had diabetes"
        disability:
          type: string
          example: "None"

    PatientResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        id:
          type: integer
          format: int64
          example: 1
        patientId:
          type: string
          example: "SNG2025001"
        firstName:
          type: string
          example: "Rahul"
        lastName:
          type: string
          example: "Patil"
        dateOfBirth:
          type: string
          format: date
          example: "1985-03-15"
        age:
          type: integer
          example: 39
        gender:
          $ref: '#/components/schemas/Gender'
        bloodGroup:
          $ref: '#/components/schemas/BloodGroup'
        aadharNumber:
          type: string
          example: "123456789012"
        photoUrl:
          type: string
          format: string
        mobileNumber:
          type: string
          example: "9876543210"
        emailId:
          type: string
          format: email
          example: "rahul.patil@gmail.com"
        preferredContactMethod:
          $ref: '#/components/schemas/PreferredContactMethod'
        addressLine1:
          type: string
          example: "123 Main Street"
        city:
          type: string
          example: "Sangli"
        district:
          type: string
          example: "Sangli"
        state:
          type: string
          example: "Maharashtra"
        pinCode:
          type: string
          example: "416416"
        emergencyContacts:
          type: array
          items:
            $ref: '#/components/schemas/EmergencyContactResponse'
        insurance:
          $ref: '#/components/schemas/InsuranceResponse'
        medicalHistory:
          $ref: '#/components/schemas/MedicalHistoryResponse'
        status:
          $ref: '#/components/schemas/PatientStatus'
        createdAt:
          type: string
          format: date-time
          example: "2025-01-20T10:30:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-21T15:45:00Z"

    EmergencyContactResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        id:
          type: integer
          format: int64
        contactPersonName:
          type: string
        relationship:
          $ref: '#/components/schemas/Relationship'
        contactNumber:
          type: string
        isPrimary:
          type: boolean

    InsuranceResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        id:
          type: integer
          format: int64
        hasInsurance:
          type: boolean
        insuranceType:
          $ref: '#/components/schemas/InsuranceType'
        schemeId:
          type: integer
          format: int64
        schemeName:
          type: string
          example: "Mahatma Jyotiba Phule Jan Arogya Yojana (MJPJAY)"
        policyCardNumber:
          type: string
        policyHolderName:
          type: string
        relationshipToHolder:
          $ref: '#/components/schemas/Relationship'
        policyExpiryDate:
          type: string
          format: date
        insuranceCardFrontUrl:
          type: string
          format: string
        insuranceCardBackUrl:
          type: string
          format: string
        pmjayCardUrl:
          type: string
          format: string
        claimAmountLimit:
          type: number
          format: decimal

    MedicalHistoryResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        id:
          type: integer
          format: int64
        knownAllergies:
          type: array
          items:
            type: string
        currentMedications:
          type: array
          items:
            type: string
        pastSurgeries:
          type: string
        chronicConditions:
          type: string
        familyMedicalHistory:
          type: string
        disability:
          type: string

    PatientPageResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/PatientResponse'
        pageable:
          $ref: '#/components/schemas/Pageable'
        totalPages:
          type: integer
          example: 5
        totalElements:
          type: integer
          format: int64
          example: 100
        last:
          type: boolean
          example: false
        size:
          type: integer
          example: 20
        number:
          type: integer
          example: 0
        numberOfElements:
          type: integer
          example: 20
        first:
          type: boolean
          example: true
        empty:
          type: boolean
          example: false

    Pageable:
      type: object
      properties:
        sort:
          $ref: '#/components/schemas/Sort'
        offset:
          type: integer
          format: int64
        pageNumber:
          type: integer
        pageSize:
          type: integer
        paged:
          type: boolean
        unpaged:
          type: boolean

    Sort:
      type: object
      properties:
        empty:
          type: boolean
        sorted:
          type: boolean
        unsorted:
          type: boolean

    # ==================== Insurance Scheme Models ====================

    InsuranceScheme:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        schemeCode:
          type: string
          example: "MJPJAY"
        schemeName:
          type: string
          example: "Mahatma Jyotiba Phule Jan Arogya Yojana (MJPJAY)"
        schemeType:
          type: string
          enum:
            - GOVERNMENT
            - PRIVATE
          example: "GOVERNMENT"
        description:
          type: string
        isActive:
          type: boolean
          example: true
        displayOrder:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # ==================== Staff Models ====================

    StaffRegistrationRequest:
      type: object
      required:
        - emailId
        - fullName
        - contactNumber
      properties:
        emailId:
          type: string
          format: email
          example: "doctor@example.com"
        fullName:
          type: string
          maxLength: 255
          example: "Dr. John Doe"
        contactNumber:
          type: string
          pattern: '^[0-9]{10}$'
          example: "9876543210"
        roles:
          type: array
          items:
            $ref: '#/components/schemas/StaffRole'
          example: ["DOCTOR"]

    StaffUpdateRequest:
      type: object
      properties:
        fullName:
          type: string
          maxLength: 255
        contactNumber:
          type: string
          pattern: '^[0-9]{10}$'
        status:
          $ref: '#/components/schemas/StaffStatus'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/StaffRole'

    StaffResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        emailId:
          type: string
          format: email
        fullName:
          type: string
        contactNumber:
          type: string
        status:
          $ref: '#/components/schemas/StaffStatus'
        roles:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # ==================== Error Models ====================

    ErrorResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2025-01-21T10:30:00Z"
        status:
          type: integer
          example: 404
        error:
          type: string
          example: "Not Found"
        message:
          type: string
          example: "Patient not found with ID: 123"
        path:
          type: string
          example: "/api/patient"

    ValidationErrorResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        timestamp:
          type: string
          format: date-time
        status:
          type: integer
          example: 400
        error:
          type: string
          example: "Validation Failed"
        message:
          type: string
          example: "Invalid input data"
        path:
          type: string
          example: "/api/patient"
        validationErrors:
          type: object
          additionalProperties:
            type: string
          example:
            firstName: "First name is required"
            mobileNumber: "Mobile number must be 10 digits"

    FailedRegistration:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        requestIndex:
          type: integer
          description: Index of the failed request in the input array
          example: 2
        patientData:
          $ref: '#/components/schemas/PatientRegistrationRequest'
        errorMessage:
          type: string
          description: Reason for failure
          example: "Patient already exists with mobileNumber: 9876543210"
        errorCode:
          type: string
          description: Error code for categorization
          enum:
            - DUPLICATE_MOBILE
            - DUPLICATE_AADHAR
            - VALIDATION_ERROR
            - INTERNAL_ERROR
          example: "DUPLICATE_MOBILE"

    BatchPatientResponse:
      type: object
      x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
      properties:
        totalRequested:
          type: integer
          description: Total number of patients in the request
          example: 5
        successCount:
          type: integer
          description: Number of successfully registered patients
          example: 4
        failureCount:
          type: integer
          description: Number of failed registrations
          example: 1
        successfulRegistrations:
          type: array
          description: List of successfully registered patients
          items:
            $ref: '#/components/schemas/PatientResponse'
        failedRegistrations:
          type: array
          description: List of failed registrations with error details
          items:
            $ref: '#/components/schemas/FailedRegistration'

        # ==================== CSV Upload Models ====================

    CsvValidationError:
          type: object
          x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
          properties:
            rowNumber:
              type: integer
              description: Row number in CSV file (1-based, excluding header)
              example: 3
            rowData:
              type: object
              additionalProperties:
                type: string
              description: Original row data from CSV
              example:
                firstName: "John"
                lastName: ""
                mobileNumber: "invalid"
            errors:
              type: array
              description: List of validation errors for this row
              items:
                type: string
              example:
                - "lastName: Last name is required"
                - "mobileNumber: Mobile number must be 10 digits"
            errorType:
              type: string
              enum:
                - VALIDATION_ERROR
                - DUPLICATE_ERROR
                - PARSING_ERROR
              example: "VALIDATION_ERROR"

    CsvUploadResponse:
          type: object
          x-class-extra-annotation: "@lombok.Data @lombok.Builder @lombok.AllArgsConstructor"
          properties:
            fileName:
              type: string
              description: Name of the uploaded file
              example: "patients.csv"
            totalRows:
              type: integer
              description: Total number of data rows in CSV (excluding header)
              example: 10
            successCount:
              type: integer
              description: Number of successfully registered patients
              example: 8
            failureCount:
              type: integer
              description: Number of failed registrations
              example: 2
            validationErrors:
              type: array
              description: List of validation errors for failed rows
              items:
                $ref: '#/components/schemas/CsvValidationError'
            successfulRegistrations:
              type: array
              description: List of successfully registered patients
              items:
                $ref: '#/components/schemas/PatientResponse'

    # ==================== Dropdown Lookup Models ====================
    DropdownLookupRequest:
      type: object
      required:
        - type
        - code
      properties:
        type:
          type: string
          description: Category/type of the lookup value
          example: "INSURANCE_SCHEME"
          maxLength: 50
        code:
          type: string
          description: Unique code within the type
          example: "PMJAY"
          maxLength: 50
        description:
          type: string
          description: Human readable description
          example: "Pradhan Mantri Jan Arogya Yojana (PM-JAY)"
          maxLength: 200
        active:
          type: boolean
          description: Whether the value is active
          default: true
        displayOrder:
          type: integer
          description: Order for display in lists
          minimum: 0
          default: 0
          example: 1

    DropdownLookupResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        type:
          type: string
          example: "INSURANCE_SCHEME"
        code:
          type: string
          example: "PMJAY"
        description:
          type: string
          example: "Pradhan Mantri Jan Arogya Yojana (PM-JAY)"
        active:
          type: boolean
          example: true
        displayOrder:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # ==================== Appointment Management Models ====================

    AppointmentStatus:
      type: string
      enum:
        - DRAFT
        - CONFIRMED
        - WAITING
        - IN_TRIAGE
        - IN_CONSULTATION
        - TO_INVOICE
        - COMPLETED
        - CANCELLED
        - NO_SHOW
        - ADMITTED
        - IN_TREATMENT
        - DISCHARGE_READY
        - DISCHARGED
      example: CONFIRMED

    AppointmentType:
      type: string
      enum:
        - OPD
        - IPD
      example: OPD

    UrgencyLevel:
      type: string
      enum:
        - NORMAL
        - URGENT
        - EMERGENCY
      example: NORMAL

    AppointmentRequest:
      type: object
      required:
        - patientId
        - appointmentDate
        - appointmentTime
        - physicianId
      properties:
        patientId:
          type: integer
          format: int64
          example: 1
        appointmentType:
          $ref: '#/components/schemas/AppointmentType'
        appointmentDate:
          type: string
          format: date
          example: "2025-11-15"
        appointmentTime:
          type: string
          pattern: '^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$'
          example: "10:30:00"
        duration:
          type: integer
          description: Duration in minutes
          default: 30
          example: 30
        departmentId:
          type: integer
          format: int64
          example: 101
        physicianId:
          type: integer
          format: int64
          example: 5
        consultationRoom:
          type: string
          maxLength: 50
          example: "Room 203"
        urgencyLevel:
          $ref: '#/components/schemas/UrgencyLevel'
        chiefComplaint:
          type: string
          example: "Fever and cough for 3 days"
        notes:
          type: string
          example: "Patient has a history of asthma"

    AppointmentResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        appointmentNumber:
          type: string
          example: "APT-20251115-00001"
        patientId:
          type: integer
          format: int64
        patientName:
          type: string
          example: "John Doe"
        appointmentType:
          $ref: '#/components/schemas/AppointmentType'
        appointmentDate:
          type: string
          format: date
        appointmentTime:
          type: string
        duration:
          type: integer
        physicianId:
          type: integer
          format: int64
        physicianName:
          type: string
          example: "Dr. Smith"
        departmentId:
          type: integer
          format: int64
        departmentName:
          type: string
          example: "General Medicine"
        consultationRoom:
          type: string
        urgencyLevel:
          $ref: '#/components/schemas/UrgencyLevel'
        status:
          $ref: '#/components/schemas/AppointmentStatus'
        chiefComplaint:
          type: string
        notes:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AppointmentDetailResponse:
      allOf:
        - $ref: '#/components/schemas/AppointmentResponse'
        - type: object
          properties:
            patient:
              type: object
              properties:
                id:
                  type: integer
                  format: int64
                name:
                  type: string
                age:
                  type: integer
                gender:
                  type: string
                contactNumber:
                  type: string
            triage:
              $ref: '#/components/schemas/TriageResponse'
            vitals:
              type: array
              items:
                $ref: '#/components/schemas/VitalsResponse'
            examination:
              $ref: '#/components/schemas/ExaminationResponse'
            prescriptions:
              type: array
              items:
                $ref: '#/components/schemas/PrescriptionResponse'
            investigations:
              type: array
              items:
                $ref: '#/components/schemas/InvestigationOrderResponse'

    AppointmentPageResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/AppointmentResponse'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        currentPage:
          type: integer
        size:
          type: integer

    TriageRequest:
      type: object
      properties:
        chiefComplaints:
          type: string
          example: "High fever and dry cough"
        historyPresentIllness:
          type: string
          example: "Fever started 3 days ago, cough since yesterday"
        pastMedicalHistory:
          type: string
          example: "Asthma diagnosed 5 years ago"
        familyHistory:
          type: string
        allergies:
          type: string
          example: "Penicillin"
        currentMedications:
          type: string
          example: "Salbutamol inhaler"
        socialHistory:
          type: string
        notes:
          type: string
          example: "Patient appears distressed"

    TriageResponse:
      allOf:
        - $ref: '#/components/schemas/TriageRequest'
        - type: object
          properties:
            id:
              type: integer
              format: int64
            appointmentId:
              type: integer
              format: int64
            recordedBy:
              type: integer
              format: int64
            recordedByName:
              type: string
            recordedAt:
              type: string
              format: date-time

    VitalsRequest:
      type: object
      properties:
        weight:
          type: number
          format: double
          description: Weight in kg
          example: 70.5
        height:
          type: number
          format: double
          description: Height in cm
          example: 175
        headCircumference:
          type: number
          format: double
          description: Head circumference in cm (pediatric)
        temperature:
          type: number
          format: double
          example: 101.5
        temperatureUnit:
          type: string
          enum: [F, C]
          default: F
        heartRate:
          type: integer
          description: Heart rate in bpm
          example: 88
        respiratoryRate:
          type: integer
          description: Respiratory rate in breaths/min
          example: 18
        systolicBp:
          type: integer
          description: Systolic BP in mmHg
          example: 120
        diastolicBp:
          type: integer
          description: Diastolic BP in mmHg
          example: 80
        spo2:
          type: number
          format: double
          description: Oxygen saturation %
          example: 96
        randomBloodSugar:
          type: number
          format: double
          description: RBS in mg/dL
          example: 110
        bmi:
          type: number
          format: double
          description: Body Mass Index
        bmiStatus:
          type: string
          enum: [Underweight, Normal, Overweight, Obese]
        painLevel:
          type: integer
          minimum: 0
          maximum: 10
          description: Pain level on 0-10 scale
          example: 3
        symptoms:
          type: array
          items:
            type: string
          example: ["Fever", "Cough", "Headache"]

    VitalsResponse:
      allOf:
        - $ref: '#/components/schemas/VitalsRequest'
        - type: object
          properties:
            id:
              type: integer
              format: int64
            appointmentId:
              type: integer
              format: int64
            recordedBy:
              type: integer
              format: int64
            recordedByName:
              type: string
            recordedAt:
              type: string
              format: date-time

    ExaminationRequest:
      type: object
      properties:
        generalAppearance:
          type: string
          example: "Patient is alert and oriented"
        cardiovascularSystem:
          type: string
          example: "S1 S2 heard, no murmurs"
        respiratorySystem:
          type: string
          example: "Bilateral air entry equal, no added sounds"
        gastrointestinalSystem:
          type: string
        centralNervousSystem:
          type: string
        musculoskeletalSystem:
          type: string
        examinationFindings:
          type: string
          example: "Mild tachycardia, temperature elevated"
        primaryDiagnosis:
          type: string
          example: "Upper Respiratory Tract Infection"
        primaryDiagnosisIcd10:
          type: string
          example: "J06.9"
        differentialDiagnosis:
          type: string
          example: "Pneumonia, Bronchitis"
        treatmentPlan:
          type: string
          example: "Antipyretics, antibiotics, rest"
        advice:
          type: string
          example: "Drink plenty of fluids, avoid cold beverages"
        followUpDate:
          type: string
          format: date
          example: "2025-11-20"
        followUpInstructions:
          type: string
          example: "Return if fever persists beyond 3 days"

    ExaminationResponse:
      allOf:
        - $ref: '#/components/schemas/ExaminationRequest'
        - type: object
          properties:
            id:
              type: integer
              format: int64
            appointmentId:
              type: integer
              format: int64
            examinedBy:
              type: integer
              format: int64
            examinedByName:
              type: string
            examinedAt:
              type: string
              format: date-time

    PrescriptionStatus:
      type: string
      enum:
        - DRAFT
        - PRESCRIBED
        - DISPENSED
      example: PRESCRIBED

    PrescriptionRequest:
      type: object
      required:
        - diagnosis
        - items
      properties:
        diagnosis:
          type: string
          example: "Upper Respiratory Tract Infection"
        medicationGroup:
          type: string
          example: "Antibiotics & Antipyretics"
        instructions:
          type: string
          example: "Complete the full course of antibiotics"
        items:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/PrescriptionItemRequest'

    PrescriptionItemRequest:
      type: object
      required:
        - medicineName
        - dosage
        - form
      properties:
        medicineName:
          type: string
          example: "Amoxicillin"
        genericName:
          type: string
          example: "Amoxicillin"
        dosage:
          type: string
          example: "500mg"
        form:
          type: string
          enum: [Tablet, Syrup, Injection, Capsule, Ointment, Drops]
          example: "Tablet"
        frequency:
          type: string
          description: Dosing frequency (e.g., 1-0-1 for Morning-Afternoon-Night)
          example: "1-0-1"
        duration:
          type: integer
          description: Treatment duration
          example: 5
        durationUnit:
          type: string
          enum: [DAYS, WEEKS, MONTHS]
          default: DAYS
          example: "DAYS"
        route:
          type: string
          enum: [Oral, IV, IM, Topical, Inhalation]
          example: "Oral"
        instructions:
          type: string
          example: "After meals"
        quantity:
          type: integer
          example: 10

    PrescriptionResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        prescriptionNumber:
          type: string
          example: "RX-20251115-00001"
        appointmentId:
          type: integer
          format: int64
        patientId:
          type: integer
          format: int64
        patientName:
          type: string
        physicianId:
          type: integer
          format: int64
        physicianName:
          type: string
        diagnosis:
          type: string
        prescriptionDate:
          type: string
          format: date
        status:
          $ref: '#/components/schemas/PrescriptionStatus'
        medicationGroup:
          type: string
        instructions:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/PrescriptionItemResponse'
        createdAt:
          type: string
          format: date-time
        dispensedAt:
          type: string
          format: date-time

    PrescriptionItemResponse:
      allOf:
        - $ref: '#/components/schemas/PrescriptionItemRequest'
        - type: object
          properties:
            id:
              type: integer
              format: int64

    InvestigationOrderType:
      type: string
      enum:
        - PATHOLOGY
        - RADIOLOGY
      example: PATHOLOGY

    InvestigationOrderStatus:
      type: string
      enum:
        - ORDERED
        - SAMPLE_COLLECTED
        - IN_PROGRESS
        - COMPLETED
        - CANCELLED
      example: ORDERED

    InvestigationUrgency:
      type: string
      enum:
        - ROUTINE
        - URGENT
        - STAT
      example: ROUTINE

    InvestigationResultStatus:
      type: string
      enum:
        - NORMAL
        - ABNORMAL
        - CRITICAL
      example: NORMAL

    InvestigationOrderRequest:
      type: object
      required:
        - orderType
        - testName
      properties:
        orderType:
          $ref: '#/components/schemas/InvestigationOrderType'
        testName:
          type: string
          example: "Complete Blood Count"
        testCode:
          type: string
          example: "CBC"
        clinicalNotes:
          type: string
          example: "Fever investigation"
        urgency:
          $ref: '#/components/schemas/InvestigationUrgency'

    InvestigationResultRequest:
      type: object
      properties:
        resultValue:
          type: string
          example: "WBC: 12000, Hb: 13.5"
        resultUnit:
          type: string
        resultStatus:
          $ref: '#/components/schemas/InvestigationResultStatus'
        resultNotes:
          type: string
          example: "Leukocytosis noted"
        resultReportUrl:
          type: string
          format: uri
          example: "https://reports.healix.com/inv-123.pdf"

    InvestigationOrderResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        orderNumber:
          type: string
          example: "INV-20251115-00001"
        appointmentId:
          type: integer
          format: int64
        patientId:
          type: integer
          format: int64
        patientName:
          type: string
        orderedBy:
          type: integer
          format: int64
        orderedByName:
          type: string
        orderType:
          $ref: '#/components/schemas/InvestigationOrderType'
        testName:
          type: string
        testCode:
          type: string
        status:
          $ref: '#/components/schemas/InvestigationOrderStatus'
        clinicalNotes:
          type: string
        urgency:
          $ref: '#/components/schemas/InvestigationUrgency'
        resultValue:
          type: string
        resultUnit:
          type: string
        resultStatus:
          $ref: '#/components/schemas/InvestigationResultStatus'
        resultReportUrl:
          type: string
        resultNotes:
          type: string
        orderedAt:
          type: string
          format: date-time
        sampleCollectedAt:
          type: string
          format: date-time
        resultReportedAt:
          type: string
          format: date-time
        reportedBy:
          type: integer
          format: int64
        reportedByName:
          type: string

    ReferralRequest:
      type: object
      required:
        - referredToDepartmentId
      properties:
        referralType:
          type: string
          enum: [INTERNAL, EXTERNAL]
          default: INTERNAL
          example: "INTERNAL"
        referredToDepartmentId:
          type: integer
          format: int64
          example: 105
        referredToPhysicianId:
          type: integer
          format: int64
          example: 12
        referralReason:
          type: string
          example: "Cardiology consultation required"
        clinicalSummary:
          type: string
          example: "Patient has chest pain, needs ECG and echo"

    AdmitRequest:
      type: object
      required:
        - bedId
      properties:
        bedId:
          type: integer
          format: int64
          example: 205
        admissionNotes:
          type: string
          example: "Patient admitted for observation and IV antibiotics"
        estimatedDischargeDate:
          type: string
          format: date-time
          example: "2025-11-20T12:00:00"

    DischargeRequest:
      type: object
      required:
        - dischargeSummary
      properties:
        dischargeSummary:
          type: string
          example: "Patient improved, vitals stable"
        dischargeInstructions:
          type: string
          example: "Continue oral medications for 5 days"
        followUpDate:
          type: string
          format: date
          example: "2025-11-25"

